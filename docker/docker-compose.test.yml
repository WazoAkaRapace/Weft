# =============================================================================
# Weft Test Database Docker Compose Configuration
# =============================================================================
# Lightweight PostgreSQL setup for local testing.
#
# Matches the CI database configuration for consistent test results.
#
# Usage:
#   docker compose -f docker/docker-compose.test.yml up -d
#   docker compose -f docker/docker-compose.test.yml down
# =============================================================================

services:
  test-db:
    image: postgres:16-alpine
    container_name: weft-test-postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: weft_test
      POSTGRES_PASSWORD: weft_test_password
      POSTGRES_DB: weft_test
    # Use different port to avoid conflict with development database
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U weft_test -d weft_test"]
      interval: 5s
      timeout: 5s
      retries: 5
      start_period: 10s
    # Optimized for testing (smaller resource footprint)
    command:
      - postgres
      - -c
      - max_connections=100
      - -c
      - shared_buffers=128MB
      - -c
      - work_mem=4MB
