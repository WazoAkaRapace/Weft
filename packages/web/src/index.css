@tailwind base;
@tailwind components;
@tailwind utilities;

/* ============================================
   WEFT Design System - CSS Variables
   ============================================ */

:root {
  /* Primary Colors (Teal - Brand Color) */
  --color-primary-50: #E6F7F7;
  --color-primary-100: #B3E6E6;
  --color-primary-200: #80D4D4;
  --color-primary-300: #4DC2C2;
  --color-primary-400: #26B0B0;
  --color-primary-500: #1A9E9E;
  --color-primary-600: #178B8B;
  --color-primary-700: #147878;
  --color-primary-800: #116565;
  --color-primary-900: #0E5252;

  /* Neutral Colors (Warm Gray - Light Mode) */
  --color-neutral-50: #FAFAF9;  /* Page background */
  --color-neutral-100: #F5F5F4; /* Card background */
  --color-neutral-200: #E7E5E4; /* Subtle borders */
  --color-neutral-300: #D6D3D1; /* Dividers */
  --color-neutral-400: #A8A29E; /* Disabled text */
  --color-neutral-500: #78716C; /* Secondary text */
  --color-neutral-600: #57534E; /* Body text */
  --color-neutral-700: #44403C; /* Headings */
  --color-neutral-800: #292524; /* Dark text */
  --color-neutral-900: #1C1917; /* Darkest text */

  /* Semantic Colors */
  --color-success-light: #ECFDF5;
  --color-success-main: #10B981;
  --color-success-dark: #059669;
  --color-success-text: #065F46;

  --color-warning-light: #FFFBEB;
  --color-warning-main: #F59E0B;
  --color-warning-dark: #D97706;
  --color-warning-text: #92400E;

  --color-error-light: #FEF2F2;
  --color-error-main: #EF4444;
  --color-error-dark: #DC2626;
  --color-error-text: #991B1B;

  --color-info-light: #EFF6FF;
  --color-info-main: #3B82F6;
  --color-info-dark: #2563EB;
  --color-info-text: #1E40AF;

  /* Emotion Colors */
  --color-emotion-happy: #FDE047;
  --color-emotion-sad: #60A5FA;
  --color-emotion-angry: #F87171;
  --color-emotion-fear: #C084FC;
  --color-emotion-surprise: #FB923C;
  --color-emotion-disgust: #86EFAC;
  --color-emotion-neutral: #A1A1AA;

  /* Base Colors */
  --color-bg-primary: var(--color-neutral-50);
  --color-bg-secondary: var(--color-neutral-100);
  --color-bg-tertiary: var(--color-neutral-200);

  --color-text-primary: var(--color-neutral-900);
  --color-text-secondary: var(--color-neutral-500);
  --color-text-tertiary: var(--color-neutral-400);

  --color-border: var(--color-neutral-200);
  --color-border-hover: var(--color-neutral-300);

  --color-brand: var(--color-primary-500);
  --color-brand-hover: var(--color-primary-600);
  --color-brand-active: var(--color-primary-700);

  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

/* Dark Mode */
.dark,
[data-theme='dark'] {
  /* Primary Colors (Brighter for dark mode) */
  --color-primary-500: #3DC9C9;
  --color-primary-600: #64D4D4;
  --color-primary-700: #8BDFDF;

  /* Dark Mode Colors (Cool Gray) */
  --color-bg-primary: #18181B;
  --color-bg-secondary: #27272A;
  --color-bg-tertiary: #3F3F46;

  --color-text-primary: #FAFAFA;
  --color-text-secondary: #A1A1AA;
  --color-text-tertiary: #71717A;

  --color-border: #3F3F46;
  --color-border-hover: #52525B;

  --color-brand: #3DC9C9;
  --color-brand-hover: #64D4D4;
  --color-brand-active: #8BDFDF;

  /* Semantic Colors (Dark Mode) */
  --color-success-light: #064E3B;
  --color-success-main: #34D399;
  --color-success-dark: #6EE7B7;
  --color-success-text: #A7F3D0;

  --color-warning-light: #78350F;
  --color-warning-main: #FBBF24;
  --color-warning-dark: #FCD34D;
  --color-warning-text: #FDE68A;

  --color-error-light: #7F1D1D;
  --color-error-main: #F87171;
  --color-error-dark: #FCA5A5;
  --color-error-text: #FECACA;

  --color-info-light: #1E3A8A;
  --color-info-main: #60A5FA;
  --color-info-dark: #93C5FD;
  --color-info-text: #BFDBFE;

  /* Shadows (lighter for dark mode) */
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
}

/* ============================================
   Custom Base Styles
   ============================================ */

* {
  box-sizing: border-box;
}

body {
  min-height: 100vh;
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
  transition: background-color 0.2s ease, color 0.2s ease;
}

/* ============================================
   MDXEditor Theming
   ============================================ */

.mdxeditor-wrapper {
  /* Light mode defaults */
  --mdxeditor-colors-prose-body: var(--color-neutral-900);
  --mdxeditor-colors-prose-headings: var(--color-neutral-900);
  --mdxeditor-colors-prose-links: var(--color-primary-500);
  --mdxeditor-colors-prose-strong: var(--color-neutral-900);
  --mdxeditor-colors-prose-code: var(--color-error-main);
  --mdxeditor-colors-backgroundColor: var(--color-neutral-50);
  --mdxeditor-colors-border: var(--color-neutral-200);
}

.dark .mdxeditor-wrapper,
[data-theme='dark'] .mdxeditor-wrapper {
  /* Dark mode overrides */
  --mdxeditor-colors-prose-body: var(--color-text-primary);
  --mdxeditor-colors-prose-headings: var(--color-text-primary);
  --mdxeditor-colors-prose-links: var(--color-primary-500);
  --mdxeditor-colors-prose-strong: var(--color-text-primary);
  --mdxeditor-colors-prose-code: var(--color-error-dark-main);
  --mdxeditor-colors-backgroundColor: var(--color-bg-secondary);
  --mdxeditor-colors-border: var(--color-border);
}

/* ============================================
   MDXEditor Content Styling
   ============================================ */

.prose {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
  line-height: 1.6;
  color: var(--color-text-primary);
  padding: 1rem;
}

.prose h1,
.prose h2,
.prose h3,
.prose h4,
.prose h5 {
  color: var(--color-text-primary);
  font-weight: 600;
  line-height: 1.2;
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
}

.prose h1 { font-size: 2.25rem; }
.prose h2 { font-size: 1.875rem; }
.prose h3 { font-size: 1.5rem; }
.prose h4 { font-size: 1.25rem; }
.prose h5 { font-size: 1.125rem; }

.prose h6 {
  font-size: 1rem;
  font-weight: 600;
  line-height: 1.5;
  margin-top: 0.5rem;
  margin-bottom: 0.25rem;
  color: var(--color-text-secondary);
}

.prose p {
  margin-bottom: 1rem;
}

.prose strong {
  font-weight: 700;
}

.prose em {
  font-style: italic;
}

.prose s,
.prose del {
  text-decoration: line-through;
  color: #666;
}

.prose code {
  background-color: var(--color-neutral-100);
  padding: 0.125rem 0.25rem;
  border-radius: 0.25rem;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: 0.875em;
  color: var(--color-error-main);
}

.prose [class*="_code"] {
  background-color: var(--color-neutral-100);
  padding: 0.125rem 0.25rem;
  border-radius: 0.25rem;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: 0.875em;
  color: var(--color-error-main);
}

.prose pre {
  background-color: var(--color-neutral-100);
  padding: 1rem;
  border-radius: 0.5rem;
  overflow-x: auto;
  margin-bottom: 1rem;
  border: 1px solid var(--color-neutral-200);
}

.prose pre code {
  background-color: transparent;
  padding: 0;
}

.prose ul {
  list-style-type: disc;
  padding-left: 1.5rem;
  margin-bottom: 1rem;
}

.prose ol {
  list-style-type: decimal;
  padding-left: 1.5rem;
  margin-bottom: 1rem;
}

.prose li {
  margin-bottom: 0.25rem;
}

.prose blockquote {
  border-left: 4px solid var(--color-primary-500);
  padding-left: 1rem;
  margin-left: 0;
  margin-bottom: 1rem;
  color: var(--color-text-secondary);
  font-style: italic;
}

.prose a {
  color: var(--color-primary-500);
  text-decoration: underline;
}

.prose a:hover {
  color: var(--color-primary-600);
}

.prose hr {
  border: none;
  border-top: 1px solid var(--color-border);
  margin: 2rem 0;
}

/* ============================================
   Dark Mode Prose Styles
   ============================================ */

.dark .prose,
[data-theme='dark'] .prose {
  color: var(--color-text-primary);
}

.dark .prose h1,
.dark .prose h2,
.dark .prose h3,
.dark .prose h4,
.dark .prose h5,
[data-theme='dark'] .prose h1,
[data-theme='dark'] .prose h2,
[data-theme='dark'] .prose h3,
[data-theme='dark'] .prose h4,
[data-theme='dark'] .prose h5 {
  color: var(--color-text-primary);
}

.dark .prose h6,
[data-theme='dark'] .prose h6 {
  color: var(--color-text-secondary);
}

.dark .prose code,
[data-theme='dark'] .prose code {
  background-color: var(--color-bg-tertiary) !important;
  color: var(--color-error-dark-main) !important;
}

.dark .prose [class*="_code"],
[data-theme='dark'] .prose [class*="_code"] {
  background-color: var(--color-bg-tertiary) !important;
  color: var(--color-error-dark-main) !important;
}

.dark .prose pre,
[data-theme='dark'] .prose pre {
  background-color: var(--color-bg-tertiary) !important;
  border-color: var(--color-border) !important;
}

.dark .prose pre code,
.dark .prose pre [class*="_code"],
[data-theme='dark'] .prose pre code,
[data-theme='dark'] .prose pre [class*="_code"] {
  background-color: transparent !important;
  color: var(--color-text-primary) !important;
}

.dark .prose blockquote,
[data-theme='dark'] .prose blockquote {
  border-left-color: var(--color-primary-500);
  color: var(--color-text-secondary);
}

.dark .prose a,
[data-theme='dark'] .prose a {
  color: var(--color-primary-500);
}

.dark .prose a:hover,
[data-theme='dark'] .prose a:hover {
  color: var(--color-primary-600);
}

.dark .prose hr,
[data-theme='dark'] .prose hr {
  border-top-color: var(--color-border);
}

/* ============================================
   Table Styles
   ============================================ */

.prose table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 1rem;
}

.prose th,
.prose td {
  border: 1px solid var(--color-border);
  padding: 0.5rem 0.75rem;
  text-align: left;
}

.prose th {
  background-color: var(--color-neutral-100);
  font-weight: 600;
  color: var(--color-text-primary);
}

.prose tr:hover {
  background-color: var(--color-neutral-50);
}

.dark .prose th,
.dark .prose td,
[data-theme='dark'] .prose th,
[data-theme='dark'] .prose td {
  border-color: var(--color-border);
}

.dark .prose th,
[data-theme='dark'] .prose th {
  background-color: var(--color-bg-tertiary);
}

.dark .prose tr:hover,
[data-theme='dark'] .prose tr:hover {
  background-color: var(--color-bg-tertiary);
}

/* Task list / checkbox styles for GFM */
.prose ul.contains-task-list {
  list-style: none;
  padding-left: 0;
}

.prose li.task-list-item {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  margin-bottom: 0.25rem;
}

.prose li.task-list-item input[type="checkbox"] {
  margin-top: 0.375rem;
  width: 1rem;
  height: 1rem;
  cursor: pointer;
}

.prose li.task-list-item.checked {
  text-decoration: line-through;
  color: var(--color-text-secondary);
}

.dark .prose s,
.dark .prose del,
[data-theme='dark'] .prose s,
[data-theme='dark'] .prose del {
  color: var(--color-text-tertiary);
}

.dark .prose li.task-list-item.checked,
[data-theme='dark'] .prose li.task-list-item.checked {
  color: var(--color-text-tertiary);
}

/* Admonition / Callout styles */
.prose [class*="admonition"] {
  border: 1px solid;
  border-radius: 0.5rem;
  padding: 1rem;
  margin-bottom: 1rem;
  display: flex;
  gap: 0.75rem;
}

.prose [class*="admonition"] [class*="nestedEditor"] {
  background-color: transparent;
  flex: 1;
}

/* Icons for each admonition type */
.prose [class*="admonitionNote"]::before {
  content: "ðŸ“";
  font-size: 1.25rem;
  flex-shrink: 0;
  line-height: 1;
}

.prose [class*="admonitionTip"]::before {
  content: "ðŸ’¡";
  font-size: 1.25rem;
  flex-shrink: 0;
  line-height: 1;
}

.prose [class*="admonitionInfo"]::before {
  content: "â„¹ï¸";
  font-size: 1.25rem;
  flex-shrink: 0;
  line-height: 1;
}

.prose [class*="admonitionCaution"]::before {
  content: "âš ï¸";
  font-size: 1.25rem;
  flex-shrink: 0;
  line-height: 1;
}

.prose [class*="admonitionDanger"]::before {
  content: "ðŸ”¥";
  font-size: 1.25rem;
  flex-shrink: 0;
  line-height: 1;
}

.prose [class*="admonitionNote"] {
  border-color: var(--color-info-main);
  background-color: var(--color-info-light);
}

.prose [class*="admonitionTip"] {
  border-color: var(--color-success-main);
  background-color: var(--color-success-light);
}

.prose [class*="admonitionInfo"] {
  border-color: var(--color-primary-400);
  background-color: var(--color-primary-50);
}

.prose [class*="admonitionCaution"] {
  border-color: var(--color-warning-main);
  background-color: var(--color-warning-light);
}

.prose [class*="admonitionDanger"] {
  border-color: var(--color-error-main);
  background-color: var(--color-error-light);
}

.prose [class*="admonition"] p {
  margin-bottom: 0;
}

/* ============================================
   Dark Mode Admonition Styles
   ============================================ */

.dark .prose [class*="admonition"] [class*="nestedEditor"],
[data-theme='dark'] .prose [class*="admonition"] [class*="nestedEditor"] {
  background-color: transparent !important;
}

.dark .prose [class*="admonitionNote"],
[data-theme='dark'] .prose [class*="admonitionNote"] {
  border-color: var(--color-info-dark-main) !important;
  background-color: var(--color-info-dark-light) !important;
}

.dark .prose [class*="admonitionTip"],
[data-theme='dark'] .prose [class*="admonitionTip"] {
  border-color: var(--color-success-dark-main) !important;
  background-color: var(--color-success-dark-light) !important;
}

.dark .prose [class*="admonitionInfo"],
[data-theme='dark'] .prose [class*="admonitionInfo"] {
  border-color: var(--color-primary-400) !important;
  background-color: rgba(58, 176, 176, 0.2) !important;
}

.dark .prose [class*="admonitionCaution"],
[data-theme='dark'] .prose [class*="admonitionCaution"] {
  border-color: var(--color-warning-dark-main) !important;
  background-color: var(--color-warning-dark-light) !important;
}

.dark .prose [class*="admonitionDanger"],
[data-theme='dark'] .prose [class*="admonitionDanger"] {
  border-color: var(--color-error-dark-main) !important;
  background-color: var(--color-error-dark-light) !important;
}

/* Dark mode admonition content text color */
.dark .prose [class*="admonitionNote"] p,
.dark .prose [class*="admonitionNote"],
[data-theme='dark'] .prose [class*="admonitionNote"] p,
[data-theme='dark'] .prose [class*="admonitionNote"] {
  color: var(--color-info-dark-text) !important;
}

.dark .prose [class*="admonitionTip"] p,
.dark .prose [class*="admonitionTip"],
[data-theme='dark'] .prose [class*="admonitionTip"] p,
[data-theme='dark'] .prose [class*="admonitionTip"] {
  color: var(--color-success-dark-text) !important;
}

.dark .prose [class*="admonitionInfo"] p,
.dark .prose [class*="admonitionInfo"],
[data-theme='dark'] .prose [class*="admonitionInfo"] p,
[data-theme='dark'] .prose [class*="admonitionInfo"] {
  color: #D9F4F4 !important;
}

.dark .prose [class*="admonitionCaution"] p,
.dark .prose [class*="admonitionCaution"],
[data-theme='dark'] .prose [class*="admonitionCaution"] p,
[data-theme='dark'] .prose [class*="admonitionCaution"] {
  color: var(--color-warning-dark-text) !important;
}

.dark .prose [class*="admonitionDanger"] p,
.dark .prose [class*="admonitionDanger"],
[data-theme='dark'] .prose [class*="admonitionDanger"] p,
[data-theme='dark'] .prose [class*="admonitionDanger"] {
  color: var(--color-error-dark-text) !important;
}

/* Hide MDXEditor toolbar in view mode */
.mdxeditor-wrapper.mdxeditor-view-mode .mdxeditor-toolbar {
  display: none !important;
}

/* Force MDXEditor to fit within viewport */
.mdxeditor,
.mdxeditor > div {
  width: 100% !important;
  max-width: 100vw !important;
  min-width: 0 !important;
}

/* ============================================
   AI Chat Streaming Animations
   ============================================ */

/* Smooth streaming cursor with soft blink animation */
@keyframes softBlink {
  0%, 40% {
    opacity: 0.7;
  }
  50%, 90% {
    opacity: 0.15;
  }
  100% {
    opacity: 0.7;
  }
}

.streaming-cursor-smooth {
  display: inline-block;
  width: 2px;
  height: 1.1em;
  background-color: currentColor;
  opacity: 0.6;
  animation: softBlink 1.2s ease-in-out infinite;
  margin-left: 1px;
  vertical-align: text-bottom;
  border-radius: 1px;
}

/* Legacy cursor class for backward compatibility */
.streaming-cursor {
  display: inline-block;
  width: 2px;
  height: 1em;
  background-color: currentColor;
  animation: softBlink 1.2s ease-in-out infinite;
  margin-left: 2px;
  vertical-align: text-bottom;
  border-radius: 1px;
}

/* ============================================
   Chat Bubble Entrance Animations
   ============================================ */

@keyframes message-enter-user {
  0% { opacity: 0; transform: translateX(20px) scale(0.95); }
  100% { opacity: 1; transform: translateX(0) scale(1); }
}

@keyframes message-enter-assistant {
  0% { opacity: 0; transform: translateX(-20px) scale(0.95); }
  100% { opacity: 1; transform: translateX(0) scale(1); }
}

.animate-message-user {
  animation: message-enter-user 200ms ease-out forwards;
}

.animate-message-assistant {
  animation: message-enter-assistant 250ms ease-out forwards;
}

/* Welcome screen exit animation */
@keyframes welcome-exit {
  0% { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: scale(0.95); }
}

.animate-welcome-exit {
  animation: welcome-exit 300ms ease-in-out forwards;
}

/* Accessibility: respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  .animate-message-user,
  .animate-message-assistant,
  .animate-welcome-exit {
    animation: none !important;
    opacity: 1 !important;
    transform: none !important;
  }
}

/* Remove prose padding inside chat bubbles (bubbles have their own padding) */
[class*="rounded-2xl"] > .prose {
  padding: 0;
}

[class*="rounded-2xl"] > .prose p {
  margin-bottom: 0.5rem;
}

[class*="rounded-2xl"] > .prose p:last-child {
  margin-bottom: 0;
}

/* ============================================
   View Transitions for Sidebar
   ============================================ */

/* Disable default cross-fade for sidebar area */
::view-transition-old(sidebar),
::view-transition-new(sidebar) {
  animation-duration: 0s;
}

/* Sidebar slide animations */
@keyframes sidebar-slide-out-left {
  from { transform: translateX(0); }
  to { transform: translateX(-100%); }
}

@keyframes sidebar-slide-in-left {
  from { transform: translateX(-100%); }
  to { transform: translateX(0); }
}

/* Apply view-transition-name to sidebars */
.sidebar-nav {
  view-transition-name: sidebar-nav;
}

.sidebar-notes {
  view-transition-name: sidebar-notes;
}

/* Animate the navigation sidebar exiting */
::view-transition-old(sidebar-nav) {
  animation: sidebar-slide-out-left 300ms ease-in-out forwards;
}

/* Animate the navigation sidebar entering */
::view-transition-new(sidebar-nav) {
  animation: sidebar-slide-in-left 300ms ease-in-out forwards;
}

/* Animate the notes sidebar exiting */
::view-transition-old(sidebar-notes) {
  animation: sidebar-slide-out-left 300ms ease-in-out forwards;
}

/* Animate the notes sidebar entering */
::view-transition-new(sidebar-notes) {
  animation: sidebar-slide-in-left 300ms ease-in-out forwards;
}

/* ============================================
   Audio Level Indicator Bars
   ============================================ */

.audio-bar {
  transition: opacity 50ms, background-color 50ms;
}

.audio-bar.active {
  background-color: #1A9E9E;
  opacity: 1;
}

.dark .audio-bar.active {
  background-color: #3DC9C9;
}

/* Accessibility: respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  .audio-bar {
    transition: none;
  }
}
